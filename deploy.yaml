import:
    - recipe/symfony.php

config:
    application: 'wiki-plab'
    repository: 'git@github.com:AlexiZ/wiki-plab.git'
    branch: 'main'
    keep_releases: 5
    composer_path: '{{deploy_path}}/.dep/composer.phar'
    shared_dirs:
        - public/uploads

hosts:
    preprod:
        hostname: '46.202.172.139' # wheat-baboon-891756.hostingersite.com
        remote_user: 'u356640788'
        http_user: 'u356640788'
        writable_mode: 'chmod'
        deploy_path: '~/domains/wheat-baboon-891756.hostingersite.com/public_html'
        identity_file: '/home/alexis/.ssh/id_rsa_4096'
        forward_agent: true
        symfony_env: 'prod'
        ssh_arguments:
            - '-p 65002'
            - '-o UserKnownHostsFile=/home/alexis/.ssh/known_hosts'

tasks:
    deploy:cleanup-repo:
        - run: 'rm -rf {{deploy_path}}/.dep/repo'

    upload_composer:
        - upload:
            src: composer.phar
            dest: '{{composer_path}}'

    upload_assets:
        - upload:
              src: 'public/build/'
              dest: '{{release_path}}/public/build/'

    deploy:
        - deploy:unlock
        - deploy:cleanup-repo
        - deploy:prepare
        - upload_composer
        - deploy:vendors
        - deploy:cache:clear
        - upload_assets
        - deploy:publish
