{% extends 'base.html.twig' %}

{% block title %}{{ 'home.title'|trans }}{% endblock %}

{% block body %}
    <div class="p-3 mb-4 bg-light rounded-3">
        <div class="container-fluid py-3">
            <h1 class="fw-bold">Bienvenue sur le Portail des associations Plabennecoises !</h1>
            <p>
                Ce site, proposé et animé par l’association <a href="https://plabennecentransition.fr/">Plabennec en Transition</a>, fonctionne comme un <a href="https://fr.wikipedia.org/wiki/Wiki">wiki</a> : chacun peut le lire et y contribuer, dans le respect de notre <a href="{{ path('publishing_charter') }}">charte d'édition</a>.
                <br>
                Son objectif est de constituer une base de données vivante et utile pour toutes celles et ceux qui souhaitent agir et participer à la transformation de leur ville.
                <br>
                Cette page a pour vocation de rendre plus accessible la richesse de la vie associative et citoyenne locale, et d’offrir un outil concret pour s’y engager.
                <br>
                Votre association n’apparaît pas encore dans la liste ? Ajoutez-la facilement en cliquant sur le bouton ci-dessous.
            </p>
            <a href="{{ path('association_new') }}" class="btn btn-success mb-3">
                <i class="fa fa-plus"></i>&nbsp;{{ 'home.associations.add.title'|trans }}
            </a>
        </div>
    </div>

    <h2 class="mb-4">{{ 'home.agenda_days'|trans({'%days%': agendaNbDays}) }}</h2>

    {% if events is not empty %}
        <div class="row mb-5">
            {% for event in events %}
                <div class="col-md-12 col-lg-6">
                    <div class="card h-100">
                        <div class="card-body d-flex justify-content-between">
                            <div class="d-flex flex-column justify-content-lg-between">
                                <h5>
                                    <a href="{{ path('event_show', {id: event.id}) }}">{{ event.title }}</a>
                                    <br>
                                    <small>{{ format_date(event.startAt, event.endAt) }}</small>
                                </h5>
                                <p class="mb-1">{{ event.shortDescription|raw }}</p>
                                <small>
                                    Par <a href="{{ path('association_show', {slug: event.association.slug}) }}">{{ event.association.name }}</a>
                                </small>
                            </div>

                            <div>
                                {% if is_granted('ASSOCIATION_EDIT', event.association) %}
                                    <a href="{{ path('event_edit', {id: event.id}) }}" class="btn btn-primary" title="{{ 'association.show.actions.edit'|trans }}">
                                        <i class="fa fa-edit"></i>
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info">{{ 'home.events.none'|trans({'%days%': agendaNbDays}) }}</div>
    {% endif %}

    <h2 class="mb-3">{{ 'home.associations.title'|trans }}</h2>

    {% if associations is not empty %}
        {% set grouped = {} %}

        {% for assoc in associations %}
            {% set firstLetter = assoc.name|first|upper %}
            {% if grouped[firstLetter] is not defined %}
                {% set grouped = grouped|merge({ (firstLetter): [assoc] }) %}
            {% else %}
                {% set grouped = grouped|merge({ (firstLetter): grouped[firstLetter]|merge([assoc]) }) %}
            {% endif %}
        {% endfor %}

        <div class="masonry">
            {% for letter in grouped|keys|sort %}
                <div class="col">
                    <h4 class="mt-3">{{ letter }}</h4>
                    <div class="list-group mb-3">
                        {% for assoc in grouped[letter]|sort((a, b) => a.name <=> b.name) %}
                            <a href="{{ path('association_show', {slug: assoc.slug}) }}" class="list-group-item list-group-item-action">
                                <i class="fa-solid fa-users me-2"></i>{{ assoc.name }}
                            </a>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info">{{ 'home.associations.list.none'|trans }}</div>
    {% endif %}

    <a href="{{ path('association_new') }}" class="btn btn-success mb-3">
        <i class="fa fa-plus"></i>&nbsp;{{ 'home.associations.add.title'|trans }}
    </a>
{% endblock %}
